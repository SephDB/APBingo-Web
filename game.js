(()=>{"use strict";var t,e,s,i,n={727:(t,e,s)=>{s.d(e,{M:()=>i,c:()=>n});class i{static fromName(t){let e=t.charCodeAt(0)-"A".charCodeAt(0),s=Number(t.slice(1))-1;return new i(s,e)}constructor(t,e){this.x=t,this.y=e}get name(){return String.fromCharCode(this.y+"A".charCodeAt(0))+(this.x+1)}toString(){return this.name}}class n{constructor(t){this.size=t,this.squares=Array(t*t),this.squares.fill(!1),this.num_bingos=0}square(t){return this.squares[t.y*this.size+t.x]}get all(){return this.squares.every(Boolean)}check(t){if(!0===this.squares[t.y*this.size+t.x])return[];this.squares[t.y*this.size+t.x]=!0;let e=Array();const s=t=>[...Array(this.size)].map(((e,s)=>this.square(new i(...t(s))))).every(Boolean),n=(t,e)=>`${new i(...t)}-${new i(...e)}`,a=this.size-1;return s((e=>[t.x,e]))&&e.push(n([t.x,0],[t.x,a])),s((e=>[e,t.y]))&&e.push(n([0,t.y],[a,t.y])),t.x==t.y&&s((t=>[t,t]))&&e.push(n([0,0],[a,a])),t.x==a-t.y&&s((t=>[t,a-t]))&&e.push(n([0,a],[a,0])),this.num_bingos+=e.length,e}}},120:(t,e,s)=>{s.a(t,(async(t,e)=>{try{var i,n,a,o,r,c=s(131),h=s(727);const l=new c.Kj;l.messages.on("chat",((t,e)=>{console.log(`${e.alias}: ${t}`)}));const d=new URLSearchParams(window.location.search),u=null!==(i=d.get("hostname"))&&void 0!==i?i:"localhost",m=null!==(n=d.get("port"))&&void 0!==n?n:"38281",p=null!==(a=d.get("hostport"))&&void 0!==a?a:`${u}:${m}`,g=null!==(o=d.get("name"))&&void 0!==o?o:"Bingo",f=null!==(r=d.get("password"))&&void 0!==r?r:"",y=await l.login(p,g,"APBingo",{password:f}),k=document.querySelector(":root");k.style.setProperty("--tilesize",100/y.boardSize+"%"),k.style.setProperty("--textColor",y.customText),k.style.setProperty("--hightlightColor",y.customHLSquare),k.style.setProperty("--squareColor",y.customSquare),k.style.setProperty("--boardColor",y.customBoard);const w=document.body,v=document.createElement("table");for(let P=0;P<y.boardSize;P++){const C=v.insertRow();for(let x=0;x<y.boardSize;x++){const S=C.insertCell();S.id=`cell${new h.M(x,P)}`;const L=document.createElement("div");L.appendChild(document.createTextNode(`${new h.M(x,P)}`)),L.appendChild(document.createElement("br")),L.appendChild(document.createTextNode(y.boardLocations[P*y.boardSize+x])),S.appendChild(L)}}w.appendChild(v);const b=new h.c(y.boardSize);function _(t){const e=h.M.fromName(t);document.getElementById(`cell${e}`).classList.add("checked");const s=b.check(e);if(s.length>0){const t=l.package.findPackage(l.game);if(null!==t){let e=Object.keys(t.locationTable).filter((t=>s.some((e=>t.startsWith(`Bingo (${e})`))))).map((e=>t.locationTable[e]));b.all&&e.push(t.locationTable["Bingo (ALL)"]),l.check(...e),b.num_bingos>=y.requiredBingoCount&&l.goal()}else console.error("PANIC, datapackage somehow not loaded yet")}}l.items.received.forEach((t=>_(t.name))),l.items.on("itemsReceived",(t=>t.forEach((t=>_(t.name))))),window.gameclient=l,window.bingo=b,e()}catch(T){e(T)}}),1)},131:(t,e,s)=>{s.d(e,{Kj:()=>U});var i=Object.defineProperty;((t,e)=>{for(var s in e)i(t,s,{get:e[s],enumerable:!0,configurable:!0,set:t=>e[s]=()=>t})})({},{slotTypes:()=>c,permissions:()=>r,itemsHandlingFlags:()=>o,itemClassifications:()=>a,clientStatuses:()=>n});var n={disconnected:0,connected:5,ready:10,playing:20,goal:30},a={progression:1,useful:2,trap:4,none:0},o={minimal:0,others:1,own:2,starting:4,all:7},r={disabled:0,enabled:1,goal:2,auto:6,autoEnabled:7},c={spectator:0,player:1,group:2};class h extends Error{}class l extends Error{argumentName;value;constructor(t,e,s){super(t),this.argumentName=e,this.value=structuredClone(s)}}class d extends Error{errors=[];constructor(t,e){super(t),this.errors=e}}class u extends Error{}var m={timeout:1e4,autoFetchDataPackage:!0,maximumMessages:1e3,debugLogVersions:!0};function p(){const t=[];for(let e=0;e<36;e++)t.push(Math.floor(16*Math.random()));return t[14]=4,t[19]=t[19]&=-5,t[19]=t[19]|=8,t[8]=t[13]=t[18]=t[23]="-",t.map((t=>t.toString(16))).join("")}var g={password:"",uuid:p(),tags:[],version:{major:0,minor:5,build:1},items:o.all,slotData:!0};class f{#t;#e;#s;#i;constructor(t,e,s,i){this.#t=t,this.#e=e,this.#s=s,this.#i=i}toString(){return this.name}get receiver(){return this.#i}get sender(){return this.#s}get name(){return this.#t.package.lookupItemName(this.game,this.#e.item,!0)}get id(){return this.#e.item}get locationName(){return this.#t.package.lookupLocationName(this.sender.game,this.#e.location,!0)}get locationId(){return this.#e.location}get locationGame(){return this.sender.game}get game(){return this.receiver.game}get progression(){return(this.flags&a.progression)===a.progression}get useful(){return(this.flags&a.useful)===a.useful}get trap(){return(this.flags&a.trap)===a.trap}get filler(){return this.flags===a.none}get flags(){return this.#e.flags}}class y{game;checksum;itemTable;locationTable;reverseItemTable;reverseLocationTable;constructor(t,e){this.game=t,this.checksum=e.checksum,this.itemTable=Object.freeze(e.item_name_to_id),this.locationTable=Object.freeze(e.location_name_to_id),this.reverseItemTable=Object.freeze(Object.fromEntries(Object.entries(this.itemTable).map((([t,e])=>[e,t])))),this.reverseLocationTable=Object.freeze(Object.fromEntries(Object.entries(this.locationTable).map((([t,e])=>[e,t]))))}exportPackage(){return{checksum:this.checksum,item_name_to_id:{...this.itemTable},location_name_to_id:{...this.locationTable}}}}class k{#t;#n=new Map;#a=new Map;#o=new Set;constructor(t){this.#t=t,this.#t.socket.on("roomInfo",(t=>{this.#n.clear(),this.#a.clear(),this.#o.clear(),this.#n.set("Archipelago",this.#r());for(const e in t.datapackage_checksums)this.#a.set(e,t.datapackage_checksums[e]),this.#o.add(e)}))}findPackage(t){return this.#n.get(t)??null}async fetchPackage(t=[],e=!0){0===t.length&&(t=Array.from(this.#o)),t=t.filter((t=>!!this.#o.has(t)&&this.#n.get(t)?.checksum!==this.#a.get(t)));const s={games:{}};for(const e of t){const t={cmd:"GetDataPackage",games:[e]},[i]=await this.#t.socket.send(t).wait("dataPackage");s.games[e]=i.data.games[e]}return e&&this.importPackage(s),s}importPackage(t){for(const e in t.games)this.#n.set(e,new y(e,t.games[e])),this.#a.set(e,t.games[e].checksum)}exportPackage(){return{games:this.#n.entries().reduce(((t,[e,s])=>(t[e]=s.exportPackage(),t)),{})}}lookupItemName(t,e,s=!0){const i=`Unknown Item ${e}`,n=this.findPackage(t);if(!n)return s?i:void 0;const a=n.reverseItemTable[e];return s&&void 0===a?i:a}lookupLocationName(t,e,s=!0){const i=`Unknown Location ${e}`,n=this.findPackage(t);if(!n)return s?i:void 0;const a=n.reverseLocationTable[e];return s&&void 0===a?i:a}#r(){return new y("Archipelago",{checksum:"ac9141e9ad0318df2fa27da5f20c50a842afeecb",item_name_to_id:{Nothing:-1},location_name_to_id:{"Cheat Console":-1,Server:-2}})}}class w{#t;#c=[];#h;#l;constructor(t,e,s){this.#t=t,this.#h=e,this.#l=s}replace(t){return this.#c.push({operation:"replace",value:t}),this}default(){return this.#c.push({operation:"default",value:null}),this}add(t){return this.#c.push({operation:"add",value:t}),this}multiply(t){return this.#c.push({operation:"mul",value:t}),this}power(t){return this.#c.push({operation:"pow",value:t}),this}remainder(t){return this.#c.push({operation:"mod",value:t}),this}floor(){return this.#c.push({operation:"floor",value:null}),this}ceiling(){return this.#c.push({operation:"ceil",value:null}),this}max(t){return this.#c.push({operation:"max",value:t}),this}min(t){return this.#c.push({operation:"min",value:t}),this}and(t){return this.#c.push({operation:"and",value:t}),this}or(t){return this.#c.push({operation:"or",value:t}),this}xor(t){return this.#c.push({operation:"xor",value:t}),this}leftShift(t){return this.#c.push({operation:"left_shift",value:t}),this}rightShift(t){return this.#c.push({operation:"right_shift",value:t}),this}remove(t){return this.#c.push({operation:"remove",value:t}),this}pop(t){return this.#c.push({operation:"pop",value:t}),this}update(t){return this.#c.push({operation:"update",value:t}),this}async commit(t=!1){const e=p(),s={cmd:"Set",default:this.#l,key:this.#h,operations:this.#c,want_reply:t,uuid:e};if(this.#t.socket.send(s),!t)return;const[i]=await this.#t.socket.wait("setReply",(t=>t.uuid===e));return i.value}}class v{#t;#d={};#u={};constructor(t){this.#t=t,this.#t.socket.on("disconnected",(()=>{this.#d={},this.#u={}})).on("setReply",(t=>{this.#d[t.key]=t.value;const e=this.#u[t.key];e&&e.forEach((e=>e(t.key,t.value,t.original_value)))})).on("connected",(()=>{if(this.#t.options.debugLogVersions){const t=`${this.#t.game}:2.0.1:${navigator?.userAgent}`;this.prepare("archipelago.js__runtimes",{}).default().update({[t]:!0}).commit(!1)}}))}get store(){return structuredClone(this.#d)}async fetch(t,e=!1){let s="string"==typeof t?[t]:t;if(e){const t=s.filter((t=>void 0===this.#d[t]));t.length>0&&this.#t.socket.send({cmd:"SetNotify",keys:t})}let i={};if(s=s.filter((t=>{const e=structuredClone(this.#d[t]),s=void 0!==e;return s&&(i[t]=e),!s})),s.length>0){const t=await this.#m(s);i={...i,...t}}return e&&(this.#d={...this.#d,...i}),"string"==typeof t?i[t]:i}async notify(t,e){return t.forEach((t=>{this.#u[t]??=[],this.#u[t].push(e)})),this.fetch(t,!0)}prepare(t,e){if(t.startsWith("_read_"))throw TypeError("Cannot manipulate read only keys.");return new w(this.#t,t,e)}async fetchItemNameGroups(t){return await this.fetch([`_read_item_name_groups_${t}`],!0)}async fetchLocationNameGroups(t){return await this.fetch([`_read_location_name_groups_${t}`],!0)}async#m(t){const e=p(),[s]=await this.#t.socket.send({cmd:"Get",keys:t,uuid:e}).wait("retrieved",(t=>t.uuid===e));return s.keys}}class b{#p={};addEventListener(t,e,s=!1){this.#p[t]??=[],this.#p[t].push([e,s])}removeEventListener(t,e){const s=this.#p[t];s&&s.length>0&&(this.#p[t]=s.filter((([t])=>t!==e)))}dispatchEvent(t,e){const s=this.#p[t]??[];for(const[i,n]of s)i(...e),n&&this.removeEventListener(t,i)}}class _{#p=new b;on(t,e){return this.#p.addEventListener(t,e),this}off(t,e){return this.#p.removeEventListener(t,e),this}async wait(t,e=()=>!0){return new Promise((s=>{const i=(...n)=>{e(...n)&&(this.#p.removeEventListener(t,i),s(n))};this.#p.addEventListener(t,i)}))}emit(t,e){this.#p.dispatchEvent(t,e)}}class P extends _{#t;#g=Number.MIN_SAFE_INTEGER;constructor(t){super(),this.#t=t,this.#t.socket.on("bounced",(t=>{if(t.tags?.includes("DeathLink")&&t.data.time&&t.data.source){const e=t.data;if(e.time===this.#g)return;this.#g=e.time,this.emit("deathReceived",[e.source,1e3*e.time,e.cause])}}))}get enabled(){return this.#t.arguments.tags.includes("DeathLink")}enableDeathLink(){this.#t.arguments.tags.includes("DeathLink")||this.#t.updateTags([...this.#t.arguments.tags,"DeathLink"])}disableDeathLink(){this.#t.arguments.tags.includes("DeathLink")&&this.#t.updateTags(this.#t.arguments.tags.filter((t=>"DeathLink"!==t)))}sendDeathLink(t,e){if(!this.#t.authenticated)throw new u("Cannot send death links before connecting and authenticating.");if(!this.enabled)return;this.#g=Math.ceil(Date.now()/1e3);const s={source:t,cause:e,time:this.#g};this.#t.bounce({tags:["DeathLink"]},s)}}class C{#t;#f;#e;constructor(t,e){this.#t=t,this.#f=e,this.#e=new f(this.#t,{item:e.item,location:e.location,player:e.finding_player,flags:e.item_flags},this.#t.players.findPlayer(e.finding_player),this.#t.players.findPlayer(e.receiving_player))}get item(){return this.#e}get found(){return this.#f.found}get entrance(){return this.#f.entrance||"Vanilla"}}class x extends _{#t;#y=[];#k=[];constructor(t){super(),this.#t=t,this.#t.socket.on("receivedItems",(t=>{let e=t.index;const s=t.items.length,i=[...t.items];for(;i.length>0;){const t=i.shift();this.#y[e++]=new f(this.#t,t,this.#t.players.findPlayer(t.player),this.#t.players.self)}this.emit("itemsReceived",[this.#y.slice(t.index,t.index+s),t.index])})).on("connected",(()=>{this.#k=[],this.#y=[],this.#t.storage.notify([`_read_hints_${this.#t.players.self.team}_${this.#t.players.self.slot}`],this.#w.bind(this)).then((t=>{const e=t[`_read_hints_${this.#t.players.self.team}_${this.#t.players.self.slot}`];this.#k=e.map((t=>new C(this.#t,t))),this.emit("hintsInitialized",[this.#k])})).catch((t=>{throw t}))}))}get received(){return[...this.#y]}get hints(){return[...this.#k]}get count(){return this.#y.length}#w(t,e){for(let t=0;t<e.length;t++)void 0===this.#k[t]?(this.#k[t]=new C(this.#t,e[t]),this.emit("hintReceived",[this.#k[t]])):this.#k[t].found!==e[t].found&&(this.#k[t]=new C(this.#t,e[t]),this.emit("hintFound",[this.#k[t]]))}}class S{client;part;constructor(t,e){this.client=t,this.part=e}toString(){return this.text}}class L extends S{part;type="item";item;constructor(t,e,s,i){super(t,e);const n=t.players.findPlayer(e.player,i.team);this.part=e,this.item=new f(t,s,n,i)}get text(){return this.item.name}}class T extends S{#v;part;type="location";id;constructor(t,e){super(t,e);const s=t.players.findPlayer(e.player),i=t.package.findPackage(s.game);this.part=e,"location_name"===e.type?(this.#v=e.text,this.id=i.locationTable[e.text]):(this.id=parseInt(e.text),this.#v=t.package.lookupLocationName(s.game,this.id,!0))}get text(){return this.#v}}class E extends S{part;type="color";color;constructor(t,e){super(t,e),this.part=e,this.color=e.color}get text(){return this.part.text}}class I extends S{part;type;constructor(t,e){super(t,e),this.part=e,"entrance_name"===this.part.type?this.type="entrance":this.type="text"}get text(){return this.part.text}}class j extends S{part;type="player";player;constructor(t,e){if(super(t,e),this.part=e,"player_id"===e.type)this.player=t.players.findPlayer(parseInt(e.text));else{const s=t.players.teams[t.players.self.team].find((t=>t.name===e.text));if(!s)throw new Error(`Cannot find player under name: ${e.text}`);this.player=s}}get text(){return this.player.alias}}class A extends _{#t;#b=[];get log(){return[...this.#b]}constructor(t){super(),this.#t=t,this.#t.socket.on("printJSON",this.#_.bind(this))}async say(t){if(!this.#t.authenticated)throw new u("Cannot send chat messages without being authenticated.");const e={cmd:"Say",text:t=t.trim()};this.#t.socket.send(e),await this.wait("chat",(e=>e===t))}#_(t){const e=[];for(const s of t.data)switch(s.type){case"item_id":case"item_name":{const i=t;let n;n="ItemCheat"===i.type?this.#t.players.findPlayer(i.receiving,i.team):this.#t.players.findPlayer(i.receiving),e.push(new L(this.#t,s,i.item,n));break}case"location_id":case"location_name":e.push(new T(this.#t,s));break;case"color":e.push(new E(this.#t,s));break;case"player_id":case"player_name":e.push(new j(this.#t,s));break;default:e.push(new I(this.#t,s))}const s=e.map((t=>t.text)).join();switch(this.#t.options.maximumMessages>=1&&(this.log.push({text:s,nodes:e}),this.log.splice(0,this.log.length-this.#t.options.maximumMessages)),t.type){case"ItemSend":{const i=this.#t.players.findPlayer(t.item.player),n=this.#t.players.findPlayer(t.receiving),a=new f(this.#t,t.item,i,n);this.emit("itemSent",[s,a,e]);break}case"ItemCheat":{const i=this.#t.players.findPlayer(t.item.player,t.team),n=this.#t.players.findPlayer(t.receiving,t.team),a=new f(this.#t,t.item,i,n);this.emit("itemCheated",[s,a,e]);break}case"Hint":{const i=this.#t.players.findPlayer(t.item.player),n=this.#t.players.findPlayer(t.receiving),a=new f(this.#t,t.item,i,n);this.emit("itemHinted",[s,a,t.found,e]);break}case"Join":{const i=this.#t.players.findPlayer(t.slot,t.team);this.emit("connected",[s,i,t.tags,e]);break}case"Part":{const i=this.#t.players.findPlayer(t.slot,t.team);this.emit("disconnected",[s,i,e]);break}case"Chat":{const s=this.#t.players.findPlayer(t.slot,t.team);this.emit("chat",[t.message,s,e]);break}case"ServerChat":this.emit("serverChat",[t.message,e]);break;case"TagsChanged":{const i=this.#t.players.findPlayer(t.slot,t.team);this.emit("tagsUpdated",[s,i,t.tags,e]);break}case"Tutorial":this.emit("tutorial",[s,e]);break;case"CommandResult":this.emit("userCommand",[s,e]);break;case"AdminCommandResult":this.emit("adminCommand",[s,e]);break;case"Goal":{const i=this.#t.players.findPlayer(t.slot,t.team);this.emit("goaled",[s,i,e]);break}case"Release":{const i=this.#t.players.findPlayer(t.slot,t.team);this.emit("released",[s,i,e]);break}case"Collect":{const i=this.#t.players.findPlayer(t.slot,t.team);this.emit("collected",[s,i,e]);break}case"Countdown":this.emit("countdown",[s,t.countdown,e])}this.emit("message",[s,e])}}class N{#t;#P;constructor(t,e){this.#t=t,this.#P=e}toString(){return this.alias}get name(){return this.#P.name}get alias(){return this.#P.alias}get game(){return 0===this.slot?"Archipelago":this.#C.game}get type(){return 0===this.slot?c.spectator:this.#C.type}get team(){return this.#P.team}get slot(){return this.#P.slot}get members(){return this.type!==c.group?[]:this.#t.players.teams[this.team].filter((t=>this.#C.group_members.includes(t.slot)))}get groups(){return 0===this.slot?[]:this.#t.players.teams[this.team].filter((t=>0!==t.slot&&this.#t.players.slots[t.slot].group_members.includes(this.slot)))}async fetchStatus(){return this.type===c.group?n.goal:await this.#t.storage.fetch(`_read_client_status_${this.team}_${this.slot}`)??0}async fetchSlotData(){return await this.#t.storage.fetch(`_read_slot_data_${this.slot}`)}async fetchHints(){return(await this.#t.storage.fetch(`_read_hints_${this.team}_${this.slot}`)).map((t=>new C(this.#t,t)))}get#C(){return this.#t.players.slots[this.slot]}}class $ extends _{#t;#x=[];#S={};#L=0;#T=0;constructor(t){super(),this.#t=t,this.#t.socket.on("connected",(t=>{this.#S=Object.freeze(t.slot_info),this.#x=[],this.#L=t.slot,this.#T=t.team;for(const e of t.players)this.#x[e.team]??=[{team:e.team,slot:0,name:"Archipelago",alias:"Archipelago"}],this.#x[e.team][e.slot]=e})).on("roomUpdate",(t=>{if(t.players)for(const e of t.players)if(this.#x[e.team][e.slot].alias!==e.alias){const t=this.#x[e.team][e.slot].alias;this.#x[e.team][e.slot]=e,this.emit("aliasUpdated",[new N(this.#t,e),t,e.alias])}}))}get self(){if(0===this.#L)throw new Error("Cannot lookup own player object when client has never connected to a server.");return new N(this.#t,this.#x[this.#T][this.#L])}get slots(){return this.#S}get teams(){const t=[];for(let e=0;e<this.#x.length;e++){t[e]=[];for(let s=0;s<this.#x[e].length;s++)t[e].push(new N(this.#t,this.#x[e][s]))}return t}findPlayer(t,e){if(void 0===e&&(e=this.#t.players.self.team),this.#x[e])return new N(this.#t,this.#x[e][t])}}class R extends _{#t;#E={major:-1,minor:-1,build:-1};#I={major:-1,minor:-1,build:-1};#o=[];#j=[];#A="";#N=!1;#$=0;#R=0;#z=0;#U={release:0,collect:0,remaining:0};#D=[];#O=[];#M=!1;get serverVersion(){return{...this.#E}}get generatorVersion(){return{...this.#I}}get games(){return[...this.#o]}get tags(){return[...this.#j]}get seedName(){return this.#A}get password(){return this.#N}get permissions(){return{...this.#U}}get hintPoints(){return this.#$}get hintCost(){return this.hintCostPercentage>0?Math.max(1,Math.floor(this.hintCostPercentage*this.allLocations.length*.01)):0}get hintCostPercentage(){return this.#R}get locationCheckPoints(){return this.#z}get missingLocations(){return[...this.#D].sort()}get checkedLocations(){return[...this.#O].sort()}get allLocations(){return[...this.#D,...this.#O].sort()}get race(){return this.#M}constructor(t){super(),this.#t=t,this.#t.socket.on("roomInfo",(t=>{this.#E={major:t.version.major,minor:t.version.minor,build:t.version.build},this.#I={major:t.generator_version.major,minor:t.generator_version.minor,build:t.generator_version.build},this.#j=t.tags,this.#o=t.games,this.#A=t.seed_name,this.#N=t.password,this.#U=t.permissions,this.#R=t.hint_cost,this.#z=t.location_check_points})).on("connected",(t=>{this.#D=t.missing_locations,this.#O=t.checked_locations,this.emit("locationsChecked",[this.checkedLocations]),this.#$=t.hint_points,this.emit("hintPointsUpdated",[0,t.hint_points])})).on("roomUpdate",(t=>{if(void 0!==t.hint_cost){const[e,s]=[this.hintCost,this.hintCostPercentage];this.#R=t.hint_cost,this.emit("hintCostUpdated",[e,this.hintCost,s,this.hintCostPercentage])}if(void 0!==t.hint_points){const e=this.#$;this.#$=t.hint_points,this.emit("hintPointsUpdated",[e,this.hintPoints])}if(void 0!==t.location_check_points){const e=this.#z;this.#z=t.location_check_points,this.emit("locationCheckPointsUpdated",[e,this.locationCheckPoints])}if(void 0!==t.password&&(this.#N=t.password,this.emit("passwordUpdated",[this.password])),void 0!==t.permissions){const e=this.#U;this.#U=t.permissions,this.emit("permissionsUpdated",[e,this.permissions])}void 0!==t.checked_locations&&(this.#O=[...this.#O,...t.checked_locations],this.#D=this.missingLocations.filter((e=>!t.checked_locations?.includes(e))),this.emit("locationsChecked",[t.checked_locations]))}))}}class z extends _{#q=null;#W=!1;constructor(){super()}get connected(){return this.#W}get url(){return this.#q?.url??""}send(...t){if(this.#q)return this.#q.send(JSON.stringify(t)),this.emit("sentPackets",[t]),this;throw new h("Unable to send packets to the server; not connected to a server.")}async connect(t){if(this.disconnect(),"string"==typeof t){if(!/^([a-zA-Z]+:)\/\/[A-Za-z0-9_.~\-:]+/i.test(t))try{return await this.connect(new URL(`wss://${t}`))}catch{return await this.connect(new URL(`ws://${t}`))}t=new URL(t)}if(t.port=t.port||"38281","wss:"!==t.protocol&&"ws:"!==t.protocol)throw new TypeError("Unexpected protocol. Archipelago only supports the ws:// and wss:// protocols.");try{return new Promise(((e,s)=>{const i=this.#V();if(null===i)throw new h("Unable to find a suitable WebSocket API in the current runtime.");this.#q=new i(t),this.#q.onmessage=this.#B.bind(this),this.#q.onclose=()=>{this.disconnect(),s(new h("Failed to connect to Archipelago server."))},this.#q.onerror=()=>{this.disconnect(),s(new h("Failed to connect to Archipelago server."))},this.#q.onopen=()=>{this.wait("roomInfo").then((([t])=>{if(this.#W=!0,this.#q)return this.#q.onclose=this.disconnect.bind(this),this.#q.onerror=this.disconnect.bind(this),void e(t);this.disconnect(),s(new h("Failed to connect to Archipelago server."))})).catch((t=>{throw t}))}}))}catch(t){throw this.disconnect(),t}}disconnect(){this.connected&&(this.#W=!1,this.#q?.close(),this.#q=null,this.emit("disconnected",[]))}#B(t){const e=JSON.parse(t.data);for(const t of e){switch(t.cmd){case"ConnectionRefused":this.emit("connectionRefused",[t]);break;case"Bounced":this.emit("bounced",[t,t.data]);break;case"Connected":this.emit("connected",[t]);break;case"DataPackage":this.emit("dataPackage",[t]);break;case"InvalidPacket":this.emit("invalidPacket",[t]);break;case"LocationInfo":this.emit("locationInfo",[t]);break;case"PrintJSON":this.emit("printJSON",[t]);break;case"ReceivedItems":this.emit("receivedItems",[t]);break;case"Retrieved":this.emit("retrieved",[t]);break;case"RoomInfo":this.emit("roomInfo",[t]);break;case"RoomUpdate":this.emit("roomUpdate",[t]);break;case"SetReply":this.emit("setReply",[t])}this.emit("receivedPacket",[t])}}#V(){let t=null;return"undefined"!=typeof window?t=window.WebSocket||window.MozWebSocket:"undefined"!=typeof global?t=global.WebSocket||global.MozWebSocket:"undefined"!=typeof self?t=self.WebSocket||self.MozWebSocket:"undefined"!=typeof WebSocket?t=WebSocket:"undefined"!=typeof MozWebSocket&&(t=MozWebSocket),t}}class U{#H=!1;#F=g;#v="";#G="";socket=new z;package=new k(this);storage=new v(this);room=new R(this);players=new $(this);items=new x(this);messages=new A(this);deathLink=new P(this);options;get authenticated(){return this.socket.connected&&this.#H}get name(){return this.#v}get game(){return this.#G}get arguments(){return{...this.#F}}constructor(t){this.options=t?{...m,...t}:{...m},this.socket.on("disconnected",(()=>{this.#H=!1})).on("sentPackets",(t=>{for(const e of t)"ConnectUpdate"===e.cmd&&(this.#F.tags=e.tags,this.#F.items=e.items_handling)}))}async login(t,e,s="",i){if(""===e)throw new l("Provided slot name cannot be blank.","name",e);this.#F=i?{...g,...i}:{...g};const n=new Set(this.arguments.tags);s||n.has("HintGame")||n.has("Tracker")||n.has("TextOnly")||n.add("TextOnly"),this.#F.tags=Array.from(n);const a={cmd:"Connect",name:e,game:s,password:this.arguments.password,slot_data:this.arguments.slotData,items_handling:this.arguments.items,uuid:this.arguments.uuid,tags:this.arguments.tags,version:{...this.arguments.version,class:"Version"}};return await this.socket.connect(t),this.options.autoFetchDataPackage&&await this.package.fetchPackage(),new Promise(((t,e)=>{const s=setTimeout((()=>e(new h("Server failed to respond in time."))),this.options.timeout),i=e=>{this.#H=!0,this.#G=e.slot_info[e.slot].game,this.#v=e.slot_info[e.slot].name,this.socket.off("connected",i).off("connectionRefused",n),clearTimeout(s),t(e.slot_data)},n=t=>{this.socket.off("connected",i).off("connectionRefused",n),clearTimeout(s),e(new d(`Connection was refused by the server. Reason(s): [${t.errors?.join(", ")}`,t.errors??[]))};this.socket.on("connected",i.bind(this)).on("connectionRefused",n.bind(this)).send(a)}))}updateStatus(t){if(!this.authenticated)throw new u("Cannot update status while not connected and authenticated.");this.socket.send({cmd:"StatusUpdate",status:t})}goal(){this.updateStatus(n.goal)}updateTags(t){if(!this.authenticated)throw new u("Cannot update tags while not connected and authenticated.");this.socket.send({cmd:"ConnectUpdate",tags:t,items_handling:this.arguments.items})}updateItemsHandling(t){if(!this.authenticated)throw new u("Cannot update tags while not connected and authenticated.");this.socket.send({cmd:"ConnectUpdate",tags:this.arguments.tags,items_handling:t})}check(...t){if(!this.authenticated)throw new u("Cannot check locations while not connected and authenticated.");t=t.filter((t=>this.room.missingLocations.includes(t))),this.socket.send({cmd:"LocationChecks",locations:t})}async scout(t,e=0){if(!this.authenticated)throw new u("Cannot scout locations while not connected and authenticated.");t=t.filter((t=>this.room.allLocations.includes(t)));const[s]=await this.socket.send({cmd:"LocationScouts",create_as_hint:e,locations:t}).wait("locationInfo",(e=>e.locations.map((t=>t.location)).toSorted().join(",")===t.toSorted().join(",")));return s.locations.map((t=>new f(this,t,this.players.self,this.players.findPlayer(t.player))))}bounce(t,e){if(!this.authenticated)throw new u("Cannot send bounces while not connected and authenticated.");this.socket.send({cmd:"Bounce",data:e,games:t.games??[],slots:t.slots??[],tags:t.tags??[]})}}}},a={};function o(t){var e=a[t];if(void 0!==e)return e.exports;var s=a[t]={exports:{}};return n[t](s,s.exports,o),s.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},o.a=(n,a,o)=>{var r;o&&((r=[]).d=-1);var c,h,l,d=new Set,u=n.exports,m=new Promise(((t,e)=>{l=e,h=t}));m[e]=u,m[t]=t=>(r&&t(r),d.forEach(t),m.catch((t=>{}))),n.exports=m,a((n=>{var a;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[t])return n;if(n.then){var a=[];a.d=0,n.then((t=>{o[e]=t,i(a)}),(t=>{o[s]=t,i(a)}));var o={};return o[t]=t=>t(a),o}}var r={};return r[t]=t=>{},r[e]=n,r})))(n);var o=()=>c.map((t=>{if(t[s])throw t[s];return t[e]})),h=new Promise((e=>{(a=()=>e(o)).r=0;var s=t=>t!==r&&!d.has(t)&&(d.add(t),t&&!t.d&&(a.r++,t.push(a)));c.map((e=>e[t](s)))}));return a.r?h:o()}),(t=>(t?l(m[s]=t):h(u),i(r)))),r&&r.d<0&&(r.d=0)},o.d=(t,e)=>{for(var s in e)o.o(e,s)&&!o.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o(120)})();